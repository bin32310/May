<?xml version="1.0" encoding="UTF-8"?>
<!-- BoardMapper.xml -->

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  	<mapper namespace="com.may.mapper.BoardMapper">
  	
  	<resultMap type="com.may.domain.UserVO" id="UserVO">
  		<result property="us_id" column="us_id"/>
  		<result property="us_pw" column="us_pw"/>
  		<result property="us_name" column="us_name"/>
  		<result property="us_nickname" column="us_nickname"/>
  		<result property="us_tel" column="us_tel"/>
  		<result property="us_state" column="us_state"/>
  		<result property="us_joinDate" column="us_joinDate"/>
  		<result property="us_outDate" column="us_outDate"/>
  	</resultMap>
  	
  	<resultMap type="com.may.domain.BoardVO" id="BoardVO">
  		<result property="bo_num" column="bo_num"/>
  		<result property="us_id" column="us_id"/>
  		<result property="bo_title" column="bo_title"/>
  		<result property="bo_content" column="bo_content"/>
  		<result property="bo_view" column="bo_view"/>
  		<result property="bo_img" column="bo_img"/>
  		<result property="bo_state" column="bo_state"/>
  		<collection property="userVO" resultMap="UserVO"/>
  	</resultMap>
  	
  
   
	<!-- 전체 글 목록(메인) -->
 	<select id="boardList" resultMap="BoardVO">
		select b.*, u.us_nickname 
		from board b join us u 
		on b.us_id = u.us_id 
		where b.bo_state = "등록"  
		order by b.bo_num desc  
		limit #{pageStart},#{pageSize} 
	</select> 
	
	<!-- 전체 글 수 조회 -->
	<select id="boardCount" resultType="int">
		select count(*) from board 
		where bo_state ="등록"   
	</select>
	
	<!-- 내 글 목록(내정보) -->
 	<select id="myBoardList" resultMap="BoardVO" parameterType="hashMap">
		select b.*, u.us_nickname 
		from board b join us u 
		on b.us_id = u.us_id 
		where b.us_id = #{us_id} and b.bo_state = "등록"  
		order by b.bo_num desc  
		limit #{pageStart},#{pageSize} 
	</select> 
	
	<!-- 내 글 수 조회 -->
	<select id="myBoardCount" resultType="int" parameterType="hashMap">
		select count(*) from board 
		where us_id= #{us_id} bo_state ="등록"   
	</select>
	
	
	<!-- 글쓰기 -->
	<insert id="boWrite">
		insert into board(bo_title, bo_content, us_id) 
		values(#{bo_title}, #{bo_content}, #{us_id})
	</insert>
	
	<!-- 가장 최신 글 번호  -->
	<select id="getBoMaxNum" resultType="int">
		select max(bo_num) from board 
	</select>
	
	<!-- 글읽기 -->
	<select id="boRead" resultMap="BoardVO">
		select * 
		from board  b join us u  
		on b.us_id = u.us_id 
		where b.bo_num = #{bo_num}
	</select>
	
	<!-- 글 조회수 증가 -->
	<update id="boViewUp">
		update board set bo_view = bo_view + 1  
		where bo_num=#{bo_num}
	</update>
	
	<!-- 글삭제 -->
	<update id="boDelete">
		update board set bo_state="삭제" 
		where bo_num=#{bo_num}
	</update>

	<!-- 글수정 -->
	<update id="boUpdate">
		update board set bo_title=#{bo_title}, bo_content=#{bo_content}  
		where bo_num=#{bo_num}
	</update>
  
  </mapper>